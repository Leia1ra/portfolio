<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}" lang="ko">

<!--뷰-->
<head>
    <meta charset="UTF-8">
    <title>PostInsertPage</title>
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
</head>
<body>
<main layout:fragment="content">
    <p>게시글 안에 들어가는 썸네일 이미지는 언제나 720*720 크기의 사진이어야 합니다.</p>
    <form action="PostInsertAction" method="get">
        <th:block th:switch="${PostData}">
            <label th:case="${null}">
                <span>게시글 이름</span> <input type="text" name="post_name" id="post_name"/>
            </label>
            <label th:case="*">
                <span>게시글 이름</span> <input type="text" name="post_name" id="post_name" th:value="${PostData.getName()}"/>
            </label>
        </th:block>
        <label th:switch="${PostData}">
            <th:block th:case="${null}">
                <span>언어</span> <select multiple name="post_lang" id="set_new_lang">
                    <option th:text="새로만들기" th:value="set_new"></option>
                    <option th:each="opt : ${Langs}" th:value="${opt.getName()}" th:text="${opt.getName()}"></option>
                </select>
                    <span>기술</span> <select multiple name="post_skill" id="set_new_skill">
                    <option th:text="새로만들기" th:value="set_new"></option>
                    <option th:each="opt : ${Skills}" th:value="${opt.getName()}" th:text="${opt.getName()}"></option>
                </select>
                <br/>
                <span>썸네일 이미지 링크: </span><input type="text" name="post_thumbnail">
            </th:block>
            <th:block th:case="*">
                <span>언어</span> <select multiple name="post_lang" id="set_new_lang">
                    <option th:text="새로만들기" th:value="set_new"></option>
                    <option th:each="opt : ${Langs}" th:value="${opt.getName()}" th:text="${opt.getName()}"
                            th:selected="${PostData.getLang_id().contains(opt.getId())}"></option>
                </select>
                    <span>기술</span> <select multiple name="post_skill" id="set_new_skill">
                    <option th:text="새로만들기" th:value="set_new"></option>
                    <option th:each="opt : ${Skills}" th:value="${opt.getName()}" th:text="${opt.getName()}"
                            th:selected="${PostData.getSkill_id().contains(opt.getId())}"></option>
                </select>
                <br/>
                <span>썸네일 이미지 링크: </span><input type="text" name="post_thumbnail" th:value="${PostData.getThumbnail()}">
            </th:block>
        </label>
        <br />
        <section id="post_elements"></section>
        <th:block th:switch="${PostData}">
            <input th:case="${null}" id="post_content" type="hidden" name="post_content" />
            <input th:case="*" id="post_content" type="hidden" name="post_content" th:value="${PostData.getContents()}"/>
        </th:block>

        <input type="submit" value="업로드">
        <script>
            const Editor = toastui.Editor;
            const Inputer = document.querySelector("#post_content");
            const post_elements = new Editor({
                el: document.querySelector('#post_elements'),
                height: '600px',
                initialEditType: 'markdown',
                previewStyle: 'vertical',
                events: {
                    change: () =>{
                        // console.log(post_elements.getMarkdown());
                        Inputer.value = post_elements.getMarkdown();
                    },
                }
            });
            post_elements.setMarkdown(document.querySelector("#post_content").value);
        </script>
    </form>
</main>
</body>
</html>