<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{fragments/layout}" lang="ko">

<!--뷰-->
<head>
	<meta charset="UTF-8">
	<title>Title</title>
	<style>
		.post_element{
			position: relative;
			display: grid;
			grid-template-columns: calc(100% - 10rem) 10rem;
			height: 10rem;
			border: var(--c3) 1px solid;
			align-content: center;
			justify-content: space-between;
			cursor: pointer;
		}
		.new_post_element{
			position: relative;
			cursor: pointer;
			height: 2.5rem;
			border: var(--c3) 1px solid;
			align-content: center;
			justify-content: space-between;
			text-align: center;
		}
		.new_post_name{
			width: 100%;
		}
		.post_element > article{
			width: 100%;
			display: flex;
			height: 10rem;
		}
		.post_element > article:hover{
			transition: 0.3s;
			background-color: var(--c4);
		}
		.thumbnail{
			display: inline-block;
		}
		.post_info{
			width: calc(100% - 10rem);
			display: grid;
			grid-row-gap: revert;
			margin-left: 1rem;
		}
		.thumbnail{
			display: inline-block;
			width: 10rem;
			height: 10rem;
		}
		.thumbnail > img{
			width: 100%;
			height: 100%;
			object-fit: cover;
		}
		.delete-button{
			background: linear-gradient(to bottom, var(--c3), var(--c4));
			color: black;
		}
		.delete-button:hover{
			transition: 0.3s;
			background: linear-gradient(to bottom, var(--c4), var(--c3));
			color: var(--c1);
		}
	</style>
</head>
<body>
<main layout:fragment="content">
	<form class="search_bar">
		<label th:switch="${Category_Langs}">
			<th:block th:case="${null}">
				<span>언어</span> <select multiple name="post_lang" id="set_lang">
					<option th:text="새로만들기" th:value="set_new"></option>
					<option th:each="opt : ${Langs}" th:value="${opt.getId()}" th:text="${opt.getName()}"></option>
				</select>
				<span>기술</span> <select multiple name="post_skill" id="set_skill">
					<option th:text="새로만들기" th:value="set_new"></option>
					<option th:each="opt : ${Skills}" th:value="${opt.getId()}" th:text="${opt.getName()}"></option>
				</select>
			</th:block>
			<th:block th:case="*">
				<span>언어</span> <select multiple name="post_lang" id="set_lang">
					<option th:text="새로만들기" th:value="set_new"></option>
					<option th:each="opt : ${Langs}" th:value="${opt.getId()}" th:text="${opt.getName()}"
							th:selected="${Category_Langs.contains(opt.getId())}"></option>
				</select>
				<span>기술</span> <select multiple name="post_skill" id="set_skill">
					<option th:text="새로만들기" th:value="set_new"></option>
					<option th:each="opt : ${Skills}" th:value="${opt.getId()}" th:text="${opt.getName()}"
							th:selected="${Category_Skills.contains(opt.getId())}"></option>
				</select>
			</th:block>
		</label>
		<label th:switch="${SearchValue}">
			<input th:case="${null}" type="text" class="search_value" name="search_value"/>
			<input th:case="*" type="text" class="search_value" name="search_value" th:value="${SearchValue}"/>
		</label>
		<input type="submit" class="search_submit" value="검색"/>
	</form>
	<section class="new_post_element">
		<article>
			<p class="new_post_name">새로 만들기</p>
		</article>
<!--		<nav class="delete">-->
<!--			<span>제거</span>-->
<!--		</nav>-->
	</section>
	<section th:each="opt : ${posts}" class="post_element">
		<article>
			<label>
				<input class="id" type="hidden" readonly  th:value="${opt.getId()}"/>
			</label>
			<nav class="thumbnail">
				<img th:src="${opt.getThumbnail()}" alt="헉! 썸네일을 불러올 수 없어요!"/>
			</nav>
			<nav class="post_info">
				<p class="post_name" th:text="${opt.getName()}"></p>
				<p class="post_category">
					<th:block th:each="ol : ${opt.getLang_id()}">
						<th:block th:each="lang : ${Langs}">
							<span th:if="${ol == lang.getId()}" th:text="${lang.getName()} "></span>
						</th:block>
					</th:block>
					<br/>
					<th:block th:each="os : ${opt.getSkill_id()}">
						<th:block th:each="skill : ${Skills}">
							<span th:if="${os == skill.getId()}" th:text="${skill.getName()} "></span>
						</th:block>
					</th:block>
				</p>
			</nav>
		</article>
		<nav class="delete">
			<span>제거</span>
		</nav>
	</section>
	<script>
		// const post_langs = document.querySelector("#set_lang");
		// const post_skills = document.querySelector("#set_skill");
		// let category_langs = "";
		// let category_skills = "";
		// post_langs.addEventListener('change', (e) => {
		// 	let result = Array.prototype.filter.call(post_langs.children,(lang) => lang.selected).map(l=>l.value);
		// 	category_langs = JSON.stringify(result);
		// 	console.log(category_langs);
		// 	// location.href="http://"+location.host + `/project/projectList/`
		// 	// 		+ `&post_langs=${category_langs}&post_skills=${category_skills}`;
		// });
		// post_skills.addEventListener('change', (e) => {
		// 	let result = Array.prototype.filter.call(post_skills.children,(skill) => skill.selected).map(s=>s.value);
		// 	category_skills = JSON.stringify(result);
		// 	console.log(category_skills);
		// 	// location.href="http://"+location.host + `/project/projectList/`
		// 	// 		+ `&post_langs=${category_langs}&post_skills=${category_skills}`;
		// });


		const post_elements = document.querySelectorAll(".post_element");
		post_elements.forEach(post => {
			post.querySelector('article').addEventListener('click', ()=>{
				location.href="http://"+location.host + '/project/projectInsertPage?id='
						+ post.querySelector('.id').value;
			});
			post.querySelector(".delete-button").addEventListener('click', () => {
				location.href = "http://"+location.host + '/project/projectDeleteAction?id='
						+ post.querySelector('.id').value;
			});
		});
		const new_post_element = document.querySelector('.new_post_element');
		new_post_element.addEventListener('click', () => {
			location.href="http://"+location.host + '/project/projectInsertPage';
		})
	</script>
</main>
</body>
</html>